<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seamless Dash | Seamex</title>
    <style>
        :root {
            --red: #A01018; --gold: #FFC107; --skyblue: #e3f2fd;
            --seamex-blue: #0984e3; --sunset: #ff7e5f; --night: #0a192f;
        }
        * { box-sizing: border-box; touch-action: none; font-family: 'Segoe UI', Roboto, sans-serif; }
        body, html { margin: 0; padding: 0; overflow: hidden; background: #000; height: 100%; }

        /* UI Layers */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; }
        .panel { background: rgba(255, 255, 255, 0.95); color: #333; padding: 2rem; border-radius: 20px; width: 90%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-top: 5px solid var(--red); }
        
        .hidden { display: none !important; }

        input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        button { background: var(--red); color: white; border: none; padding: 15px 30px; border-radius: 50px; font-weight: bold; cursor: pointer; transition: 0.3s; width: 100%; margin-top: 10px; }
        button:hover { transform: scale(1.05); background: #7a0c12; }

        .logo-box { margin-bottom: 20px; font-weight: 900; color: var(--seamex-blue); font-size: 1.2rem; }
        
        canvas { display: block; background: var(--skyblue); transition: background 2s ease; }
        
        /* Game Over Styles */
        .fact-box { font-style: italic; color: var(--seamex-blue); margin: 15px 0; font-size: 0.9rem; border-left: 3px solid var(--red); padding-left: 10px; }
        .gap-meter { font-weight: bold; color: var(--red); font-size: 1.1rem; }
    </style>
</head>
<body>

<div id="ui-layer">
    <!-- Login Screen -->
    <div id="login-panel" class="panel">
        <div class="logo-box">SEAMEX <span style="color:var(--red)">DASH</span></div>
        <input type="text" id="username" placeholder="Name (Letters only)">
        <input type="text" id="poornata-id" placeholder="Poornata ID (4-10 Digits)">
        <button onclick="app.validateLogin()">START ENGINE</button>
        <p style="font-size: 0.8rem; margin-top: 10px; color: #666;">Powered by Seamex/Poornata</p>
    </div>

    <!-- Result Screen -->
    <div id="result-panel" class="panel hidden">
        <h2 style="margin-top:0">Mission Debrief</h2>
        <p id="final-score">Score: 0</p>
        <p id="gap-message" class="gap-meter"></p>
        <div id="trivia-box" class="fact-box"></div>
        <button onclick="app.startGame()">RETRY</button>
        <button id="share-btn" style="background:var(--seamex-blue)">CHALLENGE OTHERS</button>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
/**
 * SEAMLESS DASH - GAME ENGINE
 */

const TRIVIA = [
    "Seamex is committed to excellence in offshore technical staffing.",
    "The Poornata Platform streamlines workflow efficiency across sectors.",
    "Seamex maintains a 98% client retention rate through precision service.",
    "Continuous learning is at the heart of the Poornata initiative."
];

const state = {
    MENU: 0, PLAYING: 1, GAMEOVER: 2
};

class Game {
    constructor() {
        this.canvas = document.getElementById('gameCanvas');
        this.ctx = this.canvas.getContext('2d');
        this.resize();
        
        this.gameState = state.MENU;
        this.score = 0;
        this.level = 1;
        this.user = null;
        this.highScores = JSON.parse(localStorage.getItem('seamex_lb')) || [];
        
        this.lastTime = 0;
        this.shakeTime = 0;
        this.initListeners();
        
        // Player properties
        this.player = {
            x: 50, y: 0, radius: 46,
            vy: 0, targetX: 100,
            trail: [], shieldTime: 0
        };

        this.entities = [];
        this.particles = [];
        this.loop = this.loop.bind(this);
        requestAnimationFrame(this.loop);
    }

    resize() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
    }

    initListeners() {
        window.addEventListener('mousedown', () => this.isPressing = true);
        window.addEventListener('mouseup', () => this.isPressing = false);
        window.addEventListener('touchstart', (e) => { this.isPressing = true; e.preventDefault(); }, {passive: false});
        window.addEventListener('touchend', () => this.isPressing = false);
        
        window.addEventListener('mousemove', (e) => this.handlePointer(e.clientX));
        window.addEventListener('touchmove', (e) => {
            this.handlePointer(e.touches[0].clientX);
            e.preventDefault();
        }, {passive: false});

        document.getElementById('share-btn').onclick = () => this.shareResult();
    }

    handlePointer(clientX) {
        this.player.targetX = clientX;
    }

    validateLogin() {
        const name = document.getElementById('username').value;
        const pid = document.getElementById('poornata-id').value;
        
        if(/^[a-zA-Z\s]{3,}$/.test(name) && /^\d{4,10}$/.test(pid)) {
            this.user = { name, pid };
            localStorage.setItem('seamex_user', JSON.stringify(this.user));
            document.getElementById('login-panel').classList.add('hidden');
            this.startGame();
        } else {
            alert("Please enter a valid Name (letters only) and Poornata ID (4-10 digits).");
        }
    }

    startGame() {
        this.gameState = state.PLAYING;
        this.score = 0;
        this.level = 1;
        this.player.y = this.canvas.height/2;
        this.player.vy = 0;
        this.player.shieldTime = 0;
        this.player.trail = [];
        this.entities = [];
        this.particles = [];
        document.getElementById('result-panel').classList.add('hidden');
    }

    update(dt) {
        if(this.gameState !== state.PLAYING) return;

        // Logic Scaling
        this.level = Math.floor(this.score / 100) + 1;
        this.updateBackground();

        // Player Flight (Y Physics)
        const gravity = 0.5;
        const thrust = -1.2;
        this.player.vy += (this.isPressing ? thrust : gravity);
        this.player.y += this.player.vy;

        // Follow Finger (X Smoothness)
        const dx = this.player.targetX - this.player.x;
        this.player.x += dx * 0.15;

        // Bounds
        if(this.player.y < 46) { this.player.y = 46; this.player.vy = 0; }
        if(this.player.y > this.canvas.height - 46) this.gameOver();

        // Trail Logic
        this.player.trail.push({x: this.player.x, y: this.player.y});
        if(this.player.trail.length > 10) this.player.trail.shift();

        if(this.player.shieldTime > 0) this.player.shieldTime -= dt;

        // Spawn Mechanics
        this.score += dt * 0.1;
        if(Math.random() < 0.02 + (this.level * 0.005)) this.spawnEnemy();
        if(this.score > 50 && Math.random() < 0.005) this.spawnPowerup();

        // Update Entities
        this.entities.forEach((ent, index) => {
            ent.x -= ent.speed + (this.level * 0.5);
            
            // Collision Detection
            const dist = Math.hypot(this.player.x - ent.x, this.player.y - ent.y);
            if(dist < this.player.radius + (ent.r || 20)) {
                if(ent.isShield) {
                    this.player.shieldTime = 8000;
                    this.createExplosion(ent.x, ent.y, '#FFC107');
                    this.entities.splice(index, 1);
                } else {
                    if(this.player.shieldTime > 0) {
                        this.shakeTime = 15;
                        this.createExplosion(ent.x, ent.y, '#FFF');
                        this.entities.splice(index, 1);
                    } else {
                        this.gameOver();
                    }
                }
            }

            if(ent.x < -100) this.entities.splice(index, 1);
        });

        // Screen Shake decay
        if(this.shakeTime > 0) this.shakeTime--;
    }

    updateBackground() {
        if(this.level >= 7) this.canvas.style.background = '#0a192f'; // Night
        else if(this.level >= 4) this.canvas.style.background = '#ff7e5f'; // Sunset
        else this.canvas.style.background = '#e3f2fd'; // Day
    }

    spawnEnemy() {
        this.entities.push({
            x: this.canvas.width + 100,
            y: Math.random() * this.canvas.height,
            speed: 5 + Math.random() * 5,
            r: 25 + Math.random() * 20,
            type: Math.random() > 0.5 ? 'asset1' : 'asset2'
        });
    }

    spawnPowerup() {
        this.entities.push({
            x: this.canvas.width + 100,
            y: Math.random() * this.canvas.height,
            speed: 4,
            isShield: true,
            r: 20
        });
    }

    createExplosion(x, y, color) {
        for(let i=0; i<15; i++) {
            this.particles.push({
                x, y, 
                vx: (Math.random()-0.5)*10, 
                vy: (Math.random()-0.5)*10, 
                life: 1.0, 
                color
            });
        }
    }

    draw() {
        const {ctx, canvas, player} = this;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if(this.shakeTime > 0) {
            ctx.save();
            ctx.translate((Math.random()-0.5)*10, (Math.random()-0.5)*10);
        }

        // 1. Draw Ghosting Trail
        player.trail.forEach((pos, i) => {
            ctx.globalAlpha = i / 10;
            ctx.fillStyle = player.shieldTime > 0 ? '#FFC107' : '#0984e3';
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, player.radius * (i/10), 0, Math.PI*2);
            ctx.fill();
        });
        ctx.globalAlpha = 1.0;

        // 2. Draw Entities
        this.entities.forEach(ent => {
            ctx.fillStyle = ent.isShield ? '#FFC107' : '#A01018';
            ctx.beginPath();
            if(ent.isShield) {
                // Shield Star Shape
                ctx.arc(ent.x, ent.y, 20, 0, Math.PI*2);
            } else {
                // Virus Blob
                ctx.rect(ent.x - 20, ent.y - 20, 40, 40);
            }
            ctx.fill();
        });

        // 3. Draw Player
        ctx.fillStyle = '#A01018';
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.radius, 0, Math.PI*2);
        ctx.fill();
        
        // Shield Overlay
        if(player.shieldTime > 0) {
            ctx.strokeStyle = '#FFC107';
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.radius + 5, 0, Math.PI*2);
            ctx.stroke();
        }

        // 4. Particles
        this.particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy; p.life -= 0.02;
            if(p.life <= 0) this.particles.splice(i, 1);
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life;
            ctx.fillRect(p.x, p.y, 4, 4);
        });
        ctx.globalAlpha = 1.0;

        if(this.shakeTime > 0) ctx.restore();

        // 5. Active Score UI (No Branding here per req)
        if(this.gameState === state.PLAYING) {
            ctx.fillStyle = '#000';
            ctx.font = 'bold 24px Arial';
            ctx.fillText(`Score: ${Math.floor(this.score)}`, 20, 40);
            ctx.fillText(`Level: ${this.level}`, 20, 70);
        }
    }

    gameOver() {
        this.gameState = state.GAMEOVER;
        const currentScore = Math.floor(this.score);
        
        // LocalStorage & Ranking Gap Logic
        this.highScores.push({ name: this.user.name, score: currentScore });
        this.highScores.sort((a,b) => b.score - a.score);
        localStorage.setItem('seamex_lb', JSON.stringify(this.highScores.slice(0, 10)));

        const nextPerson = this.highScores.find(h => h.score > currentScore);
        const gapMsg = nextPerson 
            ? `Only ${nextPerson.score - currentScore} points behind ${nextPerson.name}!` 
            : "YOU ARE THE TOP PERFORMER!";

        document.getElementById('final-score').innerText = `Final Score: ${currentScore}`;
        document.getElementById('gap-message').innerText = gapMsg;
        document.getElementById('trivia-box').innerText = TRIVIA[Math.floor(Math.random()*TRIVIA.length)];
        document.getElementById('result-panel').classList.remove('hidden');
    }

    shareResult() {
        const text = `I just dashed through ${Math.floor(this.score)} points on Seamex Seamless Dash! Can you beat my Poornata record?`;
        if (navigator.share) {
            navigator.share({ title: 'Seamless Dash Challenge', text, url: window.location.href });
        } else {
            navigator.clipboard.writeText(text);
            alert("Challenge message copied to clipboard!");
        }
    }

    loop(now) {
        const dt = now - this.lastTime;
        this.lastTime = now;
        this.update(dt);
        this.draw();
        requestAnimationFrame(this.loop);
    }
}

const app = new Game();
</script>
</body>
</html>
